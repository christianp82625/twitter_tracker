window.argbGreen=[[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1],[13,124,1]];

window.argbYellow=[[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0],[255,238,0]];

window.argbRed=[[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0],[255,0,0]];

var heatmapApp = (function(){
	
	var canvas,
		ctx,
		ctxRed,
		ctxGreen,
		ctxYellow,
		fcanvas,
		fctx,
		dcanvas,
		dctx,
		dctxRed,
		dctxGreen,
		dctxYellow,
		width,
		height,
		radius1 = 7,
		radius2 = 7,
		greyImage={},
		colorImage={},
	colorize = function(x,y,x2){
		if(x+x2>width)
			x=width-x2;
		if(x<0)
			x=0;
		if(y<0)
			y=0;
		if(y+x2>height)
			y=height-x2;
		y2=x2;
		
		x=0;
		y=0;
		x2=canvas.width;
		y2=canvas.height;
		
		var image = dctx.getImageData(x,y,x2,y2),
			imageData = image.data,
			length = imageData.length,
			pixels = imageData.length,
			r=0,g=0,b=0,tmp=0,alpha=0,i=3,hsl,h,rgb=[];	

		while(i<length){			
			alpha = imageData[i];			
			if(alpha>0) {				
				rgb=argb[alpha];//alphaToRGB(alpha);
				imageData[i-3]=rgb[0];
				imageData[i-2]=rgb[1];
				imageData[i-1]=rgb[2];
			}
			i+=4;			
		}

		image.data = imageData;
		ctx.putImageData(image,x,y);
	},
	colorizeRed = function(x,y,x2){
		if(x+x2>width)
			x=width-x2;
		if(x<0)
			x=0;
		if(y<0)
			y=0;
		if(y+x2>height)
			y=height-x2;
		y2=x2;
		
		x=0;
		y=0;
		x2=canvas.width;
		y2=canvas.height;
		
		var image = dctxRed.getImageData(x,y,x2,y2),
			imageData = image.data,
			length = imageData.length,
			pixels = imageData.length,
			r=0,g=0,b=0,tmp=0,alpha=0,i=3,hsl,h,rgb=[];	

		while(i<length){			
			alpha = imageData[i];			
			if(alpha>0) {				
				rgb=argbRed[alpha];//alphaToRGB(alpha);
				imageData[i-3]=rgb[0];
				imageData[i-2]=rgb[1];
				imageData[i-1]=rgb[2];				
			}
			i+=4;			
		}

		image.data = imageData;
		ctxRed.putImageData(image,x,y);
	},
	colorizeGreen = function(x,y,x2){
		if(x+x2>width)
			x=width-x2;
		if(x<0)
			x=0;
		if(y<0)
			y=0;
		if(y+x2>height)
			y=height-x2;
		y2=x2;
		
		x=0;
		y=0;
		x2=canvas.width;
		y2=canvas.height;
		
		var image = dctxGreen.getImageData(x,y,x2,y2),
			imageData = image.data,
			length = imageData.length,
			pixels = imageData.length,
			r=0,g=0,b=0,tmp=0,alpha=0,i=3,hsl,h,rgb=[];	

		while(i<length){			
			alpha = imageData[i];
			
			if(alpha>0) {				
				rgb=argbGreen[alpha];//alphaToRGB(alpha);
				imageData[i-3]=rgb[0];
				imageData[i-2]=rgb[1];
				imageData[i-1]=rgb[2];				
			}
			i+=4;			
		}

		image.data = imageData;
		ctx.putImageData(image,x,y);
	},
	colorizeYellow = function(x,y,x2){
		if(x+x2>width)
			x=width-x2;
		if(x<0)
			x=0;
		if(y<0)
			y=0;
		if(y+x2>height)
			y=height-x2;
		y2=x2;
		
		x=0;
		y=0;
		x2=canvas.width;
		y2=canvas.height;
		
		var image = dctxYellow.getImageData(x,y,x2,y2),
			imageData = image.data,
			length = imageData.length,
			pixels = imageData.length,
			r=0,g=0,b=0,tmp=0,alpha=0,i=3,hsl,h,rgb=[];	

		while(i<length){
			
			alpha = imageData[i];
			
			if(alpha>0) {
				
				rgb=argbYellow[alpha];//alphaToRGB(alpha);
				imageData[i-3]=rgb[0];
				imageData[i-2]=rgb[1];
				imageData[i-1]=rgb[2];				
			}
			i+=4;			
		}

		image.data = imageData;
		ctxYellow.putImageData(image,x,y);
	},
	colorizeBW = function(x,y,x2){
		if(x+x2>width)
			x=width-x2;
		if(x<0)
			x=0;
		if(y<0)
			y=0;
		if(y+x2>height)
			y=height-x2;
		
		var 	image = ctx.getImageData(x,y,x2,x2),
			imageData = image.data,
			length = imageData.length,
			r=0,g=0,b=0,tmp=0,alpha=0,i=3,hsl;
		
		while(i<length){
			r = 0;
			g = 0;
			b = 0;
			tmp = 0;
			alpha = imageData[i];			
			
			if(alpha>0) {
				imageData[i-3]=255-alpha;
				imageData[i-2]=255-alpha;
				imageData[i-1]=255-alpha;
			}
			i+=4;
		}

		image.data = imageData;
		ctx.putImageData(image,x,y);
	},
	fastColorize = function(){

		var image = fctx.getImageData(0,0,fcanvas.width,fcanvas.height),
			imageData = image.data,
			length = imageData.length,
			r=0,g=0,b=0,tmp=0,alpha=0,i=3,hsl;
		
		while(i<length){
			r = 0;
			g = 0;
			b = 0;
			tmp = 0;
			alpha = imageData[i];
			
			if(alpha>0) {
				
				var h=parseInt(360*alpha/255),
					rgb=argb[alpha];//alphaToRGB(alpha);
				if(rgb!=null && rgb!='undefined' && rgb) {
					imageData[i-3]=rgb[0];
					imageData[i-2]=rgb[1];
					imageData[i-1]=rgb[2];
				}
			}
			i+=4;
		}

		image.data = imageData;
		ctx.putImageData(image,0,0);
	},
	addSpot=function(x,y){
		var r1 = radius1;
		var r2 = radius2;
		var rgr = ctx.createRadialGradient(x,y,r1,x,y,r2);
		rgr.addColorStop(0, 'rgba(0,0,0,0)');  
		rgr.addColorStop(.7, 'rgba(0,0,0,0)');
		ctx.fillStyle = rgr;  
		ctx.fillRect(x-r2,y-r2,2*r2,2*r2);
		colorizeFunc(x-r2,y-r2,2*r2);
	},
	addSpotRed=function(x,y){
		var r1 = radius1;
		var r2 = radius2;
		var rgr = dctxRed.createRadialGradient(x,y,0,x,y,r2);
		rgr.addColorStop(0, 'rgba(0,0,0,1)');  
		rgr.addColorStop(.7, 'rgba(0,0,0,0)');
		dctxRed.fillStyle = rgr;  
		dctxRed.fillRect(x-r2,y-r2,2*r2,2*r2);
		colorizeFuncRed(x-r2,y-r2,2*r2);		
	},
	addSpotGreen=function(x,y){
		var r1 = radius1;
		var r2 = radius2;
		var rgr = dctxGreen.createRadialGradient(x,y,0,x,y,r2);
		rgr.addColorStop(0, 'rgba(0,0,0,1)');  
		rgr.addColorStop(.7, 'rgba(0,0,0,0)');
		dctxGreen.fillStyle = rgr;  
		dctxGreen.fillRect(x-r2,y-r2,2*r2,2*r2);
		colorizeFuncGreen(x-r2,y-r2,2*r2);		
	},
	addSpotYellow=function(x,y){
		var r1 = radius1;
		var r2 = radius2;
		var rgr = dctxYellow.createRadialGradient(x,y,0,x,y,r2);
		rgr.addColorStop(0, 'rgba(0,0,0,1)');  
		rgr.addColorStop(.8, 'rgba(0,0,0,0)');
		dctxYellow.fillStyle = rgr;  
		dctxYellow.fillRect(x-r2,y-r2,2*r2,2*r2);
		colorizeFuncYellow(x-r2,y-r2,2*r2);
		
	},
	addSpotPurple=function(x,y){
		var r1 = radius1;
		var r2 = radius2;
		var rgr = dctx.createRadialGradient(x,y,0,x,y,r2);
		rgr.addColorStop(0, 'rgba(0,0,0,0.3)');  
		rgr.addColorStop(.7, 'rgba(0,0,0,0)');
		dctx.fillStyle = rgr;  
		dctx.fillRect(x-r2,y-r2,2*r2,2*r2);
		colorizeFunc(x-r2,y-r2,2*r2);
		
	},
	addFastSpotPurple=function(x,y){
		var r1 = radius1;
		var r2 = radius2;
		var rgr = fctx.createRadialGradient(x,y,r1,x,y,r2);
		rgr.addColorStop(0, 'rgba(105,130,254,0.1)');  
		rgr.addColorStop(1, 'rgba(105,130,254,0)');
		fctx.fillStyle = rgr;  
		fctx.fillRect(x-r2,y-r2,2*r2,2*r2);
		//colorizeFunc(x-r2,y-r2,2*r2);
	},
	imageColorToBW=function(image){
		var 	imageData = image.data,
			length = imageData.length,
			r = 0,g = 0,b = 0,tmp = 0,alpha = 0,i=3;
		while(i<length) {

			r = 0;
			g = 0;
			b = 0;
			tmp = 0;
			alpha = imageData[i];			
			
			if(alpha>0) {
				imageData[i-3]=255-alpha;
				imageData[i-2]=255-alpha;
				imageData[i-1]=255-alpha;
			}
			i+=4;
		}
		image.data = imageData;
		return image;
			
	},
	imageBWToColor=function(image){
		var 	imageData = image.data,
			length = imageData.length,
			r = 0,g = 0,b = 0,tmp = 0,alpha = 0,i=3;
		while(i<length) {
			r = 0;
			g = 0;
			b = 0;
			tmp = 0;
			alpha = imageData[i];			
			if(alpha>0) {				
				var h=parseInt(360*alpha/255),
					rgb=argb[alpha];//alphaToRGB(alpha);
				if(rgb!=null && rgb!='undefined' && rgb) {
					imageData[i-3]=rgb[0];
					imageData[i-2]=rgb[1];
					imageData[i-1]=rgb[2];
				}				
			}
			i+=4;
		}
		image.data=imageData;
		return image;
		
	},
	/*switchColorizeFunc=function(c){
		switch(c){
			case 'c':
				var img=imageBWToColor(ctx.getImageData(0,0,canvas.width,canvas.height));
				ctx.clearRect(0,0,canvas.width,canvas.height);
				ctx.putImageData(img,0,0);
				colorizeFunc=colorize;
			break;
			case 'bw':
				ctx.putImageData(imageColorToBW(ctx.getImageData(0,0,canvas.width,canvas.height)),0,0);
				colorizeFunc=colorizeBW;
			break;
		}
	},*/
	fastMap=function(dots){
		var l=dots.length,i=0;
		while(i<l) {
			if($area=='world' || dots[i].cnt==$area)
				if(!dots[i].placed){
					dots[i].placed=1;
					addFastSpotPurple(dots[i].x,dots[i].y2);
					dots[i].a=0
					//console.log("add dot at "+dots[i].x+","+dots[i].y2)
				}
			i++;
		}
		fastColorize();
	},
	clearMap=function(){
		ctx.clearRect(0,0,canvas.width,canvas.width);
		fctx.clearRect(0,0,fcanvas.width,fcanvas.width);
	},
	resizeMap=function(wt,ht){
		
	};
	return {
		initialize: function(c, wt, ht){
			canvas = initCanvas(document.getElementById(c));
			
			if( canvas==null )
				return;

			//canvas = document.getElementById(c);
			canvas.width = wt;
			canvas.height = ht;
			ctx = canvas.getContext("2d");			
			
			ctxRedcanvas = initCanvas(document.getElementById("red"));
			//ctxRedcanvas = document.getElementById("red");
			ctxRedcanvas.width = wt;
			ctxRedcanvas.height = ht;
			ctxRed = ctxRedcanvas.getContext("2d");
			
			ctxGreencanvas = initCanvas(document.getElementById("green"));
			//ctxGreencanvas=document.getElementById("green");
			ctxGreencanvas.width = wt;
			ctxGreencanvas.height = ht;
			ctxGreen = ctxGreencanvas.getContext("2d");	
			
			ctxYellowcanvas = initCanvas(document.getElementById("yellow"));
			//ctxYellowcanvas=document.getElementById("yellow");
			ctxYellowcanvas.width = wt;
			ctxYellowcanvas.height = ht;
			ctxYellow = ctxYellowcanvas.getContext("2d");	
			
			fcanvas = initCanvas(document.createElement("canvas"));
			//fcanvas=document.createElement("canvas");
			fcanvas.width = wt;
			fcanvas.height = ht;
			fctx = fcanvas.getContext("2d");
			
			dRedcanvas = initCanvas(document.createElement("canvas"));
			//dRedcanvas=document.createElement("canvas");
			dRedcanvas.width = wt;
			dRedcanvas.height = ht;
			dctxRed = dRedcanvas.getContext("2d");
			
			dGreencanvas = initCanvas(document.createElement("canvas"));
			//dGreencanvas=document.createElement("canvas");
			dGreencanvas.width = wt;
			dGreencanvas.height = ht;
			dctxGreen = dGreencanvas.getContext("2d");
			
			dYellowcanvas = initCanvas(document.createElement("canvas"));
			//dYellowcanvas=document.createElement("canvas");
			dYellowcanvas.width = wt;
			dYellowcanvas.height = ht;
			dctxYellow = dYellowcanvas.getContext("2d");
			
			width = wt;
			height = ht;
			colorizeFunc = colorize;
			colorizeFuncRed = colorizeRed;
			colorizeFuncGreen = colorizeGreen;
			colorizeFuncYellow = colorizeYellow;
		},
		addSpot:addSpot,
		addSpotRed:addSpotRed,
		addSpotGreen:addSpotGreen,
		addSpotYellow:addSpotYellow,
		addSpotPurple:addSpotPurple,
		fastMap:fastMap,
		//switchColorize:switchColorizeFunc,
		clear:clearMap,
		resize:resizeMap
	};
});
